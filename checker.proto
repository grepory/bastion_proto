syntax = "proto3";

package checker;

option java_package = "co.opsee.proto";
option java_multiple_files = true;
option java_outer_classname = "BastionProto";

service Checker {
	rpc TestCheck(TestCheckRequest) returns (TestCheckResponse) {}
	rpc CreateCheck(CheckResourceRequest) returns (CheckResourceResponse) {}
	rpc RetrieveCheck(CheckResourceRequest) returns (CheckResourceResponse) {}
	rpc UpdateCheck(CheckResourceRequest) returns (CheckResourceResponse) {}
	rpc DeleteCheck(CheckResourceRequest) returns (CheckResourceResponse) {}
}

message Any {
	string type_url = 1;
	bytes value = 2;
}

message Timestamp {
	int64 seconds = 1;
	int64 nanos = 2;
}

message CheckWithId {
	string id = 1;
	Any check_spec = 2;
}

message CheckResourceResponse {
	message ResourceResponse {
		string id = 1;
		CheckWithId check_spec = 2;
		string error = 3;
	}
	repeated ResourceResponse responses = 1;
}

message CheckResourceRequest {
	repeated CheckWithId check_spec = 1;
}

message TestCheckRequest {
	int32 max_hosts = 1;
	Timestamp deadline = 2;
	Any check_spec = 3;
}

message TestCheckResponse {
	repeated Any responses = 1;
}

message Target {
	string name = 1;
	string type = 2;
	string id = 3;
}

message Header {
	string name = 1;
	repeated string values = 2;
}

message HttpCheck {
	string name = 1;
	string path = 2;
	string protocol = 3;
	int32 port = 4;
	string verb = 5;
	Target target = 6;
	repeated Header headers = 7;
	string body = 8;
}

message Metric {
	string name = 1;
	oneof value {
		int64 integer = 2;
		double decimal = 3;
	}
	repeated string tags = 4;
}

message HttpResponse {
	int32 code = 1;
	string body = 2;
	repeated Header headers = 3;
	repeated Metric metrics = 4;
	string error = 5;
	string host = 6;
}
